<h1>User <%= @user.id %></h1>

<%= link_to "Edit", edit_user_path %>

<p><%= @user.email %></p>
<p>Signed up on <%= @user.created_at.strftime("%D") %></p>

<h3>Cards</h3>

<% if @card_accounts.any? %>

  <table id="admin_user_card_accounts_table" class="table table-striped">
    <thead>
      <th>ID</th>
      <th>Name</th>
      <th>Bank</th>
      <th>B/P</th>
      <th>Brand</th>
      <th>Type</th>
      <th>Recommended</th>
      <th>Recommended at</th>
    </thead>
    <tbody>
      <% @card_accounts.each do |account| %>
        <tr id="<%= dom_id(account) %>">
          <td><%= account.card_identifier %></td>
          <td><%= account.card_name %></td>
          <td><%= account.card_bank_name %></td>
          <td><%= account.card_bank_name %></td>
          <td><%= account.card_bp.to_s.capitalize %></td>
          <td><%= account.card_brand.to_s.capitalize %></td>
          <td><%= account.card_type.to_s.capitalize %></td>
          <td><%= account.try(:recommended_at).try(:strftime, "%c") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>

  <%= t("admin.users.card_accounts.none") %>

  <hr>
<% end %>

<h3>New Card Recommendation</h3>

<%= form_for @card_recommendation, url: admin_user_card_recommendations_path(@user) do |f| %>
  
  <%#= react_component "CardRecommendationForm", cards: serialize(@cards)  %>

  <div>
    <!--
    <CardRecommendationFilters updateFilterCallback={this._updateFilters} />
    -->
    <table id="admin_user_card_accounts_table" class="table table-striped">
      <thead>
        <th></th>
        <th>ID</th>
        <th>Name</th>
        <th>Bank</th>
        <th>B/P</th>
        <th>Brand</th>
        <th>Type</th>
      </thead>
      <tbody>
        <% @cards.each do |card| %>
          <tr>
            <td><%= f.radio_button :card_id, card.id %></td>
            <td><%= card.identifier %></td>
            <td><%= card.name %></td>
            <td><%= card.bank_name %></td>
            <td><%= card.bp.capitalize %></td>
            <td><%= card.brand.capitalize %></td>
            <td><%= card.type.capitalize %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div>
    Recommend this card to the user
    <small>User will receive a notification and the card will appear
      under 'New recommendations'</small>
    <%= radio_button_tag :new_card_account_type, :recommendation %>
  </div>

  <div>
    Assign this card to the user
    <small>Card will appear in the user's list of cards, but they will not
      receive a notification. Use this option to e.g. add a card which the user
      already has but forgot to tell us about in the onboarding survey, or to
      re-add a card that accidentally got deleted.</small>
    <%= radio_button_tag :new_card_account_type, :assignment %>

    <%= select_tag :type, options_for_select(CardAccount.statuses) %>
  </div>
    
  <%= f.submit "Submit", class: "btn-primary" %>
<% end %>

<%= link_to 'Back to all users', admin_users_path %>
