<% cache(@airports) do %>
  <%
    array_for_typeahead = @airports.map do |airport|
      id = airport.id
      name = airport.name
      code = airport.code
      city_name = airport.city_name

      displayed_name = airport.full_name

      {
        id: id,
        code: code,
        name: displayed_name,
        tokens: [code, city_name, "#{city_name} (#{displayed_name})", "#{name} (#{code})"]
      }
    end
  %>
  <%= raw(array_for_typeahead.to_json) %>
<% end %>
